<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="intercambio-app">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <h2>[[prop1]]!</h2>

        <input type="file" id="fileInput" on-change="_file" accept="[[acceptedFile]]">
    </template>

    <script>
        /**
         * @customElement
         * @polymer
         */
        class IntercambioApp extends Polymer.Element {
            static get is() {
                return 'intercambio-app';
            }

            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: 'intercambio-app'
                    },
                    acceptedFile: {
                        type: String,
                        value: '.txt'
                    }
                };
            }

            _file(e) {
                let file = e.target.files[0];
                let self = this;
                let content;
                if (!file)
                    return;

                let read = new FileReader();

                read.onload = function(e) {
                    content = e.target.result;
                    self._getValues(content);
                };
                read.readAsText(file);
            }

            _getValues(content) {
                console.log(content);

                let value;
                let arr = [];

                for (let i = 2; i < content.length; i++) {
                    value = this.findAnotherNumber(content, i + 1);

                    if (value != i) {
                        let concat = "";

                        for (let j = i; j <= value; j++)
                            if (content[j])
                                concat += content[j];
                        i = value;

                        arr.push(concat);
                    }
                }
                this.findMoney(arr)
            }

            findAnotherNumber(array, pos) {
                if (array[pos] == " " || array.length < pos || array[pos] == '\n') {
                    return pos - 1;
                }

                return this.findAnotherNumber(array, pos + 1);
            }

            findMoney(array) {
                let money = [];
                let pit = 0;

                for (let i = 1; i < array.length; i += (parseInt(array[i]) + 3) - 1) {
                    pit += (parseInt(array[i]) + 2);

                    for (let j = i + 1; j < pit; j++)
                        money.push(array[j]);

                    this.optimitation(array[i - 1], money);

                    money = [];
                }
            }

            optimitation(amount, array) {
                let total = 0;
                let arrLessUsed = [];
                let lessMoneyUsed = 0;
                let ban = false;
                let cont = 0;
                let cont2 = 0;

                for (let i = 1; i <= amount; i++) {
                    lessMoneyUsed = amount;

                    console.log("another one" + i);
                    for (let j = 0; j < array.length && !ban; j++) {
                        cont2 = 1;
                        total = (parseInt(array[j])) - i;

                        if (total == 0 && cont2 < lessMoneyUsed) {
                            lessMoneyUsed = cont2;
                        }
                        if (total > 0) {
                            let result = (cont2) + this.findOptimalChange(total, array);

                            console.log("result: "+result,cont2,this.findOptimalChange(total, array));
                            if (lessMoneyUsed > result)
                                lessMoneyUsed = result;
                        }

                        console.log("step1 " + total,(parseInt(array[j])),i ,(parseInt(array[j])) - i, cont2, lessMoneyUsed);
                        for (let k = 0; k < array.length; k++) {
                            if (lessMoneyUsed - 1 == 0) {
                                ban = true;
                                break;
                            }
                            cont=1;
                            total = ((parseInt(array[j])) + (parseInt(array[k]))) - i;

                            console.log("step2 " + total,(parseInt(array[j])),(parseInt(array[k])),((parseInt(array[j])) + (parseInt(array[k]))), i, lessMoneyUsed);
                            if (total == 0 && ((cont2) + (cont)) < lessMoneyUsed) {
                                console.log("here1");
                                lessMoneyUsed = ((cont2) + (cont));
                            }

                            if (total > 0) {
                                let result = ((cont2) + (cont)) + this.findOptimalChange(total, array);
                                console.log("here2: "+((cont2) + (cont)),this.findOptimalChange(total, array));
                                if (lessMoneyUsed > result)
                                    lessMoneyUsed = result;
                            }

                        }
                        cont = 1;
                    }

                    console.log(lessMoneyUsed);
                    arrLessUsed.push(lessMoneyUsed);

                    ban = false;
                    lessMoneyUsed = 0;
                }

                console.log(" monto " + amount, " monedas " + array);
                console.log("solutions: " + arrLessUsed + " average: " + this.average(arrLessUsed)+ " More usage: " + this.usage(arrLessUsed));
            }

            findOptimalChange(total, array) {
                let totalC = 0;
                let lessMoneyUsed = total;
                let cont=0;
                let cont2=0;

                for (let i = 0; i < array.length; i++) {
                    totalC = (parseInt(array[i])) - total;
                    cont2=1;

                    if (totalC == 0 && cont2 < lessMoneyUsed) {
                        lessMoneyUsed = (cont2);
                    }

                    for (let j = 0; j < array.length; j++) {
                        totalC = ((parseInt(array[i])) + (parseInt(array[j]))) - total;
                        cont=1;
                        if (totalC == 0 && ((cont) + (cont2)) < lessMoneyUsed) {
                            lessMoneyUsed = ((cont) + (cont2));
                        }
                    }

                }
                console.log("???"+lessMoneyUsed);
                return lessMoneyUsed;
            }

            average(array){
                let acum=0;

                for(let i=0;i<array.length;i++)
                    acum+=array[i];

                return acum/array.length;
            }
            usage(array){
                let max=0;

                for(let i=0,len=array.length;i<len;i++){
                    if(max < array[i]){
                        max = array[i];
                    }
                }
                return max;
            }
        }

        window.customElements.define(IntercambioApp.is, IntercambioApp);
    </script>
</dom-module>
