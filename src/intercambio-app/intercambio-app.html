<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="intercambio-app">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <h2>[[prop1]]!</h2>

        <input type="file" id="fileInput" on-change="_file" accept="[[acceptedFile]]">
    </template>

    <script>
        /**
         * @customElement
         * @polymer
         */
        class IntercambioApp extends Polymer.Element {
            static get is() {
                return 'intercambio-app';
            }

            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: 'intercambio-app'
                    },
                    acceptedFile: {
                        type: String,
                        value: '.txt'
                    }
                };
            }

            _file(e) {
                let file = e.target.files[0];
                let self = this;
                let content;

                if (!file)
                    return;

                let read = new FileReader();

                read.onload = function(e) {
                    content = e.target.result;

                    self._getValues(content);
                };

                read.readAsText(file);
            }

            _getValues(content) {
                console.log(content);

                let value;
                let arr = [];

                for (let i = 2; i < content.length; i++) {
                    value = this.findAnotherNumber(content, i + 1);

                    if (value != i) {
                        let concat = "";

                        for (let j = i; j <= value; j++)
                            if (content[j])
                                concat += content[j];
                        i = value;

                        arr.push(concat);
                    }
                }
                this.findMoney(arr)
            }

            findAnotherNumber(array, pos) {
                if (array[pos] == " " || array.length < pos || array[pos] == '\n') {
                    return pos - 1;
                }

                return this.findAnotherNumber(array, pos + 1);
            }

            findMoney(array) {
                let money = [];
                let pit = 0;

                for (let i = 1; i < array.length; i += (parseInt(array[i]) + 3) - 1) {
                    pit += (parseInt(array[i]) + 2);

                    for (let j = i + 1; j < pit; j++)
                        money.push(array[j]);

                    this.prerecursiva(array[i - 1], money, array[i]);

                    money = [];
                }
            }

            prerecursiva(amount, array, deep) {
                let result;
                amount = 100;
                let lessUsed;
                let arrLessUsed = [];
                let ban = false;

                for (let i = 1; i <= amount; i++) {
                    lessUsed = amount + 1;
                    //for (let k = 0; array.length; k++) {
                   // console.log("title: " + i);
                    for (let j = 0; j < array.length; j++) {
                        //if (i == 13)
                        //    console.log("menos usado: " + lessUsed + " monto a comparar: " + i);

                        result = this.recursiva2(parseInt(array[j]), i, 1, array, 0, deep, 0);
                        // result = this.recursiva2(parseInt(array[j]), i, cont, array, -1);
                        // console.log(result);
                        if (result < lessUsed) {
                            ban = true;
                            lessUsed = result;
                        }
                    }
                    if (ban) {
                        arrLessUsed.push(lessUsed);
                        ban = false
                    }
                    if (i == 13)
                    //    console.log("menos modenas usadas: " + lessUsed, " para cantidad: " + i);
                    // }
                        result = 0;
                }

                console.log("resultado: " + arrLessUsed);
                console.log("average: " + this.average(arrLessUsed) + " More Interchange: " + this.usage(arrLessUsed));
            }

            recursiva2(value, amount, cont, list, pos, deepMax, deepMin) {

                let comp1;
                let comp2 = amount + 1;
                let comp3 = amount + 1;
                let comp4;
                let comp5 = amount + 1;
                let min;

                comp1 = this.Nrecursiva1(value, amount, cont);

                for (let i = 0; i < list.length; i++) {
                    min = this.Nrecursiva2(value + parseInt(list[i]), amount, cont + 1, list, i, deepMax, deepMin + 1);
                    if (min < comp2)
                        comp2 = min;
                }
                min = amount + 1;

                for (let i = 0; i < list.length; i++) {
                    min = this.Nrecursiva3(value + parseInt(list[i]), amount, cont + 1, list, i,deepMax,deepMin);
                    if (min < comp3)
                        comp3 = min;
                }
                comp4 = this.recursivaCambio(value, amount, list, deepMax, deepMin);

                for (let i = 0; i < list.length; i++) {
                    min = this.NrecursivaCambioMayor(value - parseInt(list[i]), amount, cont + 1, list, i, deepMax, deepMin + 1);
                    if (min < comp5)
                        comp5 = min;
                }


                if (comp1 == undefined)
                    comp1 = amount + 1;
                if (comp2 == undefined)
                    comp2 = amount + 1;
                if (comp3 == undefined)
                    comp3 = amount + 1;
                if (comp4 == undefined)
                    comp4 = amount + 1;
                if (comp5 == undefined)
                    comp5 = amount + 1;

                if (comp1 < comp2)
                    if (comp1 < comp3)
                        if (comp1 < comp4)
                            return comp1;

                if (comp2 < comp3)
                    if (comp2 < comp4)
                        return comp2;

                if (comp3 < comp4)
                    if (comp3 < comp5)
                        return comp3;
                if (comp4 < comp5)
                    return comp4;

                return comp5;
            }

            Nrecursiva1(value, amount, cont) {
                if (value == amount)
                    return cont;
            }

            Nrecursiva2(value, amount, cont, list, pos, deepMax, deepMin) {
                if (deepMin <= deepMax) {
                    let res;
                    let min = amount;
                    if (value == amount)
                        return cont;
                    if (value > amount) {
                        for (let i = 0; i < list.length; i++) {
                            res = this.NrecursivaCambioMayor(value - parseInt(list[i]), amount, cont + 1, list, i, deepMax, deepMin + 1);
                            if (res < min)
                                min = res;
                        }
                        return min;
                    }
                    return this.Nrecursiva2(value + parseInt(list[pos]), amount, cont + 1, list, pos, deepMax, deepMin + 1);
                }
            }

            Nrecursiva3(value, amount, cont, list, pos,deepMax,deepMin) {
                let other = pos + 1;
                if (other <= list.length) {
                    let res;
                    let min = amount;
                    if (value == amount)
                        return cont;
                    if (value > amount) {
                        for (let i = 0; i < list.length; i++) {
                            res = this.NrecursivaCambioMayor(value - parseInt(list[i]), amount, cont + 1, list, i, deepMax, deepMin + 1);
                            if (res < min)
                                min = res;
                        }
                        return min;
                    }
                    return this.Nrecursiva3(value + parseInt(list[other]), amount, cont + 1, list, other);
                }
            }

            NrecursivaCambioMayor(value, amount, cont, list, pos, deepMax, deepMin) {
                if (deepMin <= deepMax) {
                    if (value == amount)
                        return cont;
                    return this.NrecursivaCambioMayor(value - parseInt(list[pos]), amount, cont + 1, list, deepMax, deepMin + 1);
                }
            }

            recursivaCambio(value, amount, list, deepMax, deepMin) {
                let lessUsed = amount;
                let result;

                for (let i = 0; i < list.length; i++) {
                    if (parseInt(list[i]) < value)
                        result = this.NrecursivaCambio(parseInt(list[i]), amount, 1, list, 0, deepMax, deepMin);

                    if (result < lessUsed)
                        lessUsed = result;
                }

                return lessUsed;
            }

            NrecursivaCambio(value, amount, cont, list, pos, deepMax, deepMin) {
                let comp1;
                let comp2 = amount + 1;
                let comp3 = amount + 1;
                let min;

                comp1 = this.NrecursivaCambio1(value, amount, cont);

                for (let i = 0; i < list.length; i++) {
                    min = this.NrecursivaCambio2(value + parseInt(list[i]), amount, cont + 1, list, pos, deepMax, deepMin + 1);
                    if (min < comp2)
                        comp2 = min;
                }
                min = amount + 1;

                for (let i = 0; i < list.length; i++) {
                    min = this.NrecursivaCambio3(value + parseInt(list[i]), amount, cont + 1, list, i);
                    if (min < comp3)
                        comp3 = min;
                }

                if (comp1 == undefined)
                    comp1 = amount + 1;
                if (comp2 == undefined)
                    comp2 = amount + 1;
                if (comp3 == undefined)
                    comp3 = amount + 1;

                if (comp1 < comp2)
                    if (comp1 < comp3)
                        return comp1;

                if (comp2 < comp3)
                    return comp2;
                return comp3;
            }

            NrecursivaCambio1(value, amount, cont) {
                if (value - amount == 0)
                    return cont;
            }

            NrecursivaCambio2(value, amount, cont, list, pos, deepMax, deepMin) {
                if (deepMin <= deepMax) {
                    if (value - amount == 0)
                        return cont;

                    return this.NrecursivaCambio2(value + parseInt(list[pos]), amount, cont + 1, list, pos, deepMax, deepMin + 1);
                }
            }

            NrecursivaCambio3(value, amount, cont, list, pos) {
                let other = pos + 1;

                if (other <= list.length) {
                    if (value - amount == 0)
                        return cont;

                    return this.NrecursivaCambio3(value + parseInt(list[other]), amount, cont + 1, list, other);
                }
            }

            average(array) {
                let acum = 0;

                for (let i = 0; i < array.length; i++)
                    acum += array[i];

                return acum / array.length;
            }

            usage(array) {
                let max = 0;

                for (let i = 0, len = array.length; i < len; i++)
                    if (max < array[i])
                        max = array[i];

                return max;
            }
        }

        window.customElements.define(IntercambioApp.is, IntercambioApp);
    </script>
</dom-module>
